{% extends "backbone_base.html" %}
{% block title %}Latest posts{% endblock %}
{% block content %}
<noscript>
<h1>Welcome{% if user.is_authenticated %} {{ user.username }}{% endif %}! Here are the latest posts:</h1>
{% if posts %}
<div id="post-list">
    {% include "post_list.html" %}
</div>
    {% if posts|length < total_posts %}
        {% include "load_more_posts.html" with page="home" %}
    {% endif %}
{% else %}
    <h2>Sorry, no posts in database.</h2>
{% endif %}
</noscript>
{% endblock %}
{% block backbone_init %}
{% autoescape off %}
    <script type="text/javascript">
        $(function() {
            if ($('#create-new-post')[0] != undefined) {
                $('#create-new-post')[0].pathname = ''
                $('#create-new-post')[0].hash = 'create_post'
            }
            app.blogCollection = new app.BlogCollection();
            app.blogRouter = new Workspace();
            app.blogView = new app.BlogView({collection: app.blogCollection});
            Backbone.history.start();
            if (window.app && window.location.hash === '') {
                app.blogCollection.next = '{{ next }}';
                app.blogCollection.count = {{ total_posts }};
                app.blogCollection.reset({{ models_json }});
            }else{
                var route = window.location.hash.substring(1,window.location.hash.length);
                app.blogRouter.navigate(route, {trigger: true, replace: true});
            }
        });
    </script>
{% endautoescape %}
{% endblock %}